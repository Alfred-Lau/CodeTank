{"version":3,"sources":["main.js"],"names":[],"mappings":";;AAKA;;;;AACA;;;;;;AANA,IAAM,MAAM,QAAQ,SAAR,CAAZ;AACA,IAAM,UAAU,QAAQ,SAAR,CAAhB;AACA,IAAM,MAAM,QAAQ,KAAR,CAAZ;AACA,IAAM,OAAO,QAAQ,MAAR,CAAb;;AAKA,IAAM,SAAS,iBAAQ,KAAvB;;AAGA,IAAI,OAAO,gBAAM,UAAN,CAAiB,MAAjB,CAAX;;AAEA,IAAM,YAAY,+BAAlB;;AAEA;;AAEA,IAAI,SAAS,EAAb;;AAEA,SAAS,WAAT,CAAqB,EAArB,EAAyB;AACrB,QAAI,SAAS,IAAI,OAAJ,CAAY,SAAZ,EAAuB,EAAvB,IAA6B,OAA1C;AACA,YAAQ,MAAR,EAAgB,UAAC,GAAD,EAAM,GAAN,EAAW,IAAX,EAAoB;AAChC,YAAI,CAAC,GAAD,IAAQ,IAAI,UAAJ,IAAkB,GAA9B,EAAmC;AAC/B,gBAAI,IAAI,IAAI,IAAJ,CAAS,IAAT,CAAR;;AAEA,gBAAI,MAAM,EAAV;AACA;AACA,gBAAI,SAAS,EAAE,eAAF,EAAmB,EAAnB,CAAsB,CAAtB,EAAyB,IAAzB,CAA8B,GAA9B,EAAmC,IAAnC,EAAb;AACA;AACA,gBAAI,OAAO,EAAE,mCAAF,EAAuC,IAAvC,EAAX;AACA;AACA,gBAAI,OAAO,EAAE,eAAF,EAAmB,EAAnB,CAAsB,CAAtB,EAAyB,IAAzB,EAAX;AACA;AACA,gBAAI,OAAO,EAAE,eAAF,EAAmB,EAAnB,CAAsB,CAAtB,EAAyB,IAAzB,EAAX;AACA;AACA,gBAAI,QAAQ,EAAE,eAAF,EAAmB,EAAnB,CAAsB,CAAtB,EAAyB,IAAzB,EAAZ;AACA;AACA,gBAAI,MAAM,EAAE,eAAF,EAAmB,EAAnB,CAAsB,CAAtB,EAAyB,IAAzB,EAAV;AACA;AACA,gBAAI,SAAS,EAAE,eAAF,EAAmB,EAAnB,CAAsB,CAAtB,EAAyB,IAAzB,EAAb;AACA;AACA,gBAAI,UAAU,EAAE,yBAAF,EAA6B,IAA7B,EAAd;AACA;AACA,gBAAI,SAAS,EAAb;AACA,gBAAI,SAAS;AACT,oBAAI,GADK;AAET,wBAAQ,MAFC;AAGT,sBAAM,IAHG;AAIT,sBAAM,IAJG;AAKT,sBAAM,IALG;AAMT,uBAAO,KANE;AAOT,qBAAK,GAPI;AAQT,wBAAQ,MARC;AAST,yBAAS,OATA;AAUT,wBAAQ;AAVC,aAAb;AAYA;AACA;AACA,iBAAK,aAAL,CAAmB,UAAC,GAAD,EAAM,UAAN,EAAqB;AACpC,oBAAI,GAAJ,EAAS;AACL,0BAAM,GAAN;AACH;AACD,2BAAW,KAAX,CAAiB,6BAAjB,EAAgD,MAAhD,EAAwD,UAAC,GAAD,EAAM,IAAN,EAAY,KAAZ,EAAsB;AAC1E,wBAAI,GAAJ,EAAS,MAAM,GAAN;AACT,+BAAW,KAAX,CAAiB,kCAAjB,EAAqD,UAAC,GAAD,EAAM,OAAN,EAAkB;AACnE,4BAAI,GAAJ,EAAS;AACL,oCAAQ,GAAR,CAAY,MAAZ;AACH,yBAFD,MAEO;AACH,oCAAQ,GAAR,CAAY,KAAK,OAAL,CAAa,OAAb,CAAZ;AACH;AACJ,qBAND;AAOA,+BAAW,OAAX;AACH,iBAVD;AAWH,aAfD;AAgBH,SApDD,MAoDO;AACH,oBAAQ,GAAR,CAAY,GAAZ;AACH;AACJ,KAxDD;AAyDH;;AAED,SAAS,EAAT,CAAY,OAAZ,EAAqB;AACjB,YAAQ,OAAR,EAAiB,UAAC,GAAD,EAAM,GAAN,EAAW,IAAX,EAAoB;AACjC,YAAI,CAAC,GAAD,IAAQ,IAAI,UAAJ,IAAkB,GAA9B,EAAmC;AAAA;AAC/B,oBAAI,IAAI,IAAI,IAAJ,CAAS,IAAT,CAAR;AACA,kBAAE,iBAAF,EAAqB,IAArB,CAA0B,UAAC,KAAD,EAAQ,IAAR,EAAiB;AACvC;AACA,wBAAI,KAAK,EAAE,IAAF,EAAQ,IAAR,CAAa,SAAb,CAAT;AACA,2BAAO,YAAY,EAAZ,CAAP;AACH,iBAJD;AAF+B;AAOlC,SAPD,MAOO;AACH,oBAAQ,GAAR,CAAY,GAAZ;AACH;AACJ,KAXD;AAYH;;AAED,SAAS,UAAT,CAAoB,OAApB,EAA6B;AACzB,WAAO,GAAG,OAAH,CAAP;AACH;;AAED,QAAQ,GAAR,CAAY,SAAZ,EAAuB,UAAC,GAAD,EAAM,GAAN,EAAW,IAAX,EAAoB;AACvC,QAAI,CAAC,GAAD,IAAQ,IAAI,UAAJ,IAAkB,GAA9B,EAAmC;AAAA,YAG3B,aAH2B;AAAA,YAI3B,OAJ2B;AAAA,YAMtB,CANsB;AAAA,YAcnB,OAdmB;;AAAA;AAC/B,gBAAI,IAAI,IAAI,IAAJ,CAAS,IAAT,CAAR;AACA;AACI,4BAAgB,EAAE,iCAAF,EAAqC,IAArC,CAA0C,WAA1C,CAHW;AAI3B,sBAAU,SAAS,KAAK,KAAL,CAAW,aAAX,EAA0B,SAAnC,EAA8C,EAA9C,CAJiB;;;AAM/B,iBAAS,IAAI,CAAb,EAAgB,IAAI,UAAU,CAA9B,EAAiC,GAAjC,EAAsC;AAClC,oBAAI,KAAK,CAAT,EAAY;AACR,sBAAE,iBAAF,EAAqB,IAArB,CAA0B,UAAC,KAAD,EAAQ,IAAR,EAAiB;AACvC;AACA,4BAAI,KAAK,EAAE,IAAF,EAAQ,IAAR,CAAa,SAAb,CAAT;AACA,oCAAY,EAAZ;AACH,qBAJD;AAKH,iBAND,MAMO;AACC,8BAAU,YAAY,IAAZ,GAAmB,EAAE,QAAF,EAAnB,GAAkC,GAD7C;;AAEH,+BAAW,OAAX;AACH;AACJ;AAjB8B;AAkBlC,KAlBD,MAkBO;AACH;AACH;AACJ,CAtBD;AAuBA;;AAEA","file":"main-compiled.js","sourcesContent":["const cio = require('cheerio');\nconst request = require('request');\nconst url = require('url');\nconst util = require('util');\n\nimport mysql from 'mysql';\nimport options from '../config/config';\n\nconst option = options.mysql;\n\n\nlet pool = mysql.createPool(option);\n\nconst webPrefix = 'http://bj.lianjia.com/zufang/';\n\n// 1.抓取首页，判断多少套房，进而判断多少页，作为循环参数\n\nvar destId = [];\n\nfunction getContents(id) {\n    var dstUrl = url.resolve(webPrefix, id) + \".html\";\n    request(dstUrl, (err, res, body) => {\n        if (!err && res.statusCode == 200) {\n            var $ = cio.load(body);\n\n            var _id = id;\n            // 所在区域\n            var region = $('div.zf-room p').eq(6).find('a').text();\n            // 租金\n            var rent = $('div.content.zf-content span.total').text();\n            // 面积\n            var area = $('div.zf-room p').eq(0).text();\n            // 房型\n            var type = $('div.zf-room p').eq(1).text();\n            // 楼层\n            var floor = $('div.zf-room p').eq(2).text();\n            // 房屋朝向\n            var dir = $('div.zf-room p').eq(3).text();\n            // 地铁情况\n            var subway = $('div.zf-room p').eq(4).text();\n            // 房源特色\n            var special = $('div.featureContent span').text();\n            // 其他（更新时间，多少人看过此房，同小区成交记录，特殊标示（自如））\n            var others = '';\n            var source = {\n                id: _id,\n                region: region,\n                rent: rent,\n                area: area,\n                type: type,\n                floor: floor,\n                dir: dir,\n                subway: subway,\n                special: special,\n                others: others\n            };\n            // console.log(util.inspect(source));\n            // 存入Mysql数据库\n            pool.getConnection((err, connection) => {\n                if (err) {\n                    throw err;\n                }\n                connection.query('insert into housedata set ?', source, (err, rows, field) => {\n                    if (err) throw err;\n                    connection.query('select * from housedata limit 10', (err, results) => {\n                        if (err) {\n                            console.log('查询失败');\n                        } else {\n                            console.log(util.inspect(results));\n                        }\n                    })\n                    connection.release();\n                })\n            })\n        } else {\n            console.log(err);\n        }\n    });\n}\n\nfunction cb(listUrl) {\n    request(listUrl, (err, res, body) => {\n        if (!err && res.statusCode == 200) {\n            let $ = cio.load(body);\n            $(\"ul#house-lst li\").each((index, elem) => {\n                //和jquery转换为dom的语法完全一致\n                var id = $(elem).attr('data-id');\n                return getContents(id);\n            });\n        } else {\n            console.log(err);\n        }\n    });\n}\n\nfunction getUrlAsyn(listUrl) {\n    return cb(listUrl);\n}\n\nrequest.get(webPrefix, (err, res, body) => {\n    if (!err && res.statusCode == 200) {\n        let $ = cio.load(body);\n        // 判断多少页\n        var pageNumString = $('div.page-box.house-lst-page-box').attr('page-data');\n        var pageNum = parseInt(JSON.parse(pageNumString).totalPage, 10);\n\n        for (var i = 1; i < pageNum + 1; i++) {\n            if (i == 1) {\n                $(\"ul#house-lst li\").each((index, elem) => {\n                    //和jquery转换为dom的语法完全一致\n                    var id = $(elem).attr('data-id');\n                    getContents(id);\n                });\n            } else {\n                var listUrl = webPrefix + 'pg' + i.toString() + '/';\n                getUrlAsyn(listUrl);\n            }\n        }\n    } else {\n        return;\n    }\n});\n// 2.拼接url，得到页面上面的url的a链接，持久化，为第三步访问具体页面做好准备\n\n// 3.访问具体房源页面，分析抓取相关信息，再次拼接，做好持久化，完成任务\n"]}